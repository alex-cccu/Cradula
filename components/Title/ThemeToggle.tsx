"use client";

import { useTheme } from "next-themes";
import { useEffect, useState } from "react";
import { motion, AnimatePresence } from "framer-motion";
import { SunIcon, MoonIcon } from "@heroicons/react/24/solid";

export default function ThemeToggle() {
  const { theme, setTheme } = useTheme();
  const [mounted, setMounted] = useState(false);
  const [flash, setFlash] = useState(false);

  useEffect(() => setMounted(true), []);

  const toggleTheme = () => {
    setFlash(true);
    setTimeout(() => setFlash(false), 600); // duration matches flash + rumble
    setTimeout(() => setTheme(theme === "dark" ? "light" : "dark"), 300);
  };

  return (
    <div className="relative">
      {/* Button */}

      <button
        onClick={toggleTheme}
        aria-label="Toggle dark mode"
        className="w-12 h-12 flex items-center justify-center rounded-full bg-neutral-100 dark:bg-neutral-900 hover:scale-115 hover:-rotate-6 transition-transform ease-in-out duration-500"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="163.25 166.84 571.09 570.56"
          preserveAspectRatio="xMidYMid meet"
          className="z-1 absolute w-[80px] h-[80px] md:w-[300px] md:h-[300px]"
        >
          <g>
            <path
              d="M711.537,578.953c-11.191,11.673-31.44,8.987-44.278-0.844    c-12.838-9.836-20.46-24.788-29.065-38.479s-19.707-27.348-35.326-31.541c-15.62-4.192-35.623,6.266-35.331,22.433    c0.216,11.613,10.278,22.478,6.939,33.604c-2.902,9.655-14.51,13.752-24.592,13.787s-20.349-2.51-30.12-0.04    c-15.881,4.017-26.048,20.902-26.595,37.274c-0.552,16.368,6.653,32.048,15.514,45.82c5.719,8.882,12.296,17.492,15.253,27.634    c2.952,10.142,1.316,22.543-7.094,28.935c-13.581,10.323-34.307-2.561-39.243-18.888c-4.93-16.328-0.025-33.755,1.998-50.69    c2.023-16.935-0.311-36.878-14.515-46.322c-15.243-10.137-37.47-1.923-47.567,13.345c-10.097,15.268-10.609,34.97-8.013,53.09    c1.592,11.081,3.645,24.055-4.223,32.023c-9.846,9.976-28.649,2.616-33.996-10.343c-5.347-12.954-1.059-27.84,4.951-40.503    c6.01-12.662,13.822-24.883,15.79-38.76c1.968-13.878-4.293-30.351-17.789-34.126c-10.855-3.033-27.022,0.251-29.818-10.664    c-1.125-4.398,1.09-9.263-0.527-13.506c-2.807-7.371-13.471-6.492-20.892-3.821c-7.421,2.676-17.372,5.061-21.81-1.456    c-4.74-6.954,2.224-15.65,4.458-23.763c4.217-15.323-10.915-30.496-26.691-32.429s-31.099,5.267-45.242,12.517    c-8.515,4.358-17.236,8.892-26.746,9.906c-9.514,1.019-20.148-2.31-25.024-10.539c-9.083-15.333,7.883-34.538,25.42-37.706    c19.114-3.449,38.64,3.68,58.03,2.495c19.385-1.18,41.05-17.859,34.879-36.275c-1.828-5.443-5.919-10.202-6.241-15.936    c-0.502-8.806,7.938-15.434,16.062-18.863c8.129-3.429,17.387-5.754,22.84-12.688c10.368-13.195-0.693-33.373-15.474-41.316    c-14.781-7.948-32.439-9.133-47.301-16.93c-14.856-7.802-26.289-27.644-16.313-41.135c8.104-10.965,25.285-10.318,37.249-3.781    c11.965,6.532,20.997,17.357,32.309,24.968c11.312,7.612,27.323,11.478,38.118,3.148c12.903-9.961,10.162-30.747,1.245-44.394    c-8.917-13.641-22.438-24.095-29.733-38.67c-7.295-14.575-4.629-36.592,10.88-41.607c12.683-4.107,26.279,6.191,31.119,18.617    c4.835,12.421,3.469,26.249,3.007,39.574c-0.462,13.325,0.412,27.705,8.646,38.188c0.542,0.688,1.125,1.346,1.742,1.973    c8.957,9.027,23.633,8.46,32.459-0.693c3.55-3.685,7.466-6.959,11.899-9.59c12.918-7.662,31.626-7.832,41.216,3.73    c2.912,3.505,4.8,7.817,8.028,11.036c4.238,4.228,9.781,4.699,15.052,3.64c9.891-1.983,17.949-9.148,21.499-18.597    c8.294-22.076,5.432-35.271,17.327-56.79c8.601-15.569,25.119-13.667,31.28-6.843c5.623,6.221,2.907,20.229-2.46,26.67    c-5.367,6.442-12.903,10.77-18.376,17.121c-2.224,2.581-4.022,5.372-5.468,8.319c-6.255,12.789-5.093,27.813,2.386,39.683    c1.089,1.728,2.784,3.02,4.779,3.454c0.011,0.003,0.023,0.005,0.034,0.007c4.413,0.949,9.153-0.517,13.461,0.828    c5.628,1.762,8.882,7.988,9.052,13.877c0.009,0.283,0.012,0.565,0.009,0.846c-0.047,5.697,3.512,10.852,8.989,12.423    c2.31,0.663,4.586,0.953,6.793,0.779c12.11-0.954,22.117-9.61,30.381-18.512c8.264-8.902,16.187-18.808,27.303-23.703    c11.116-4.9,26.665-2.485,31.701,8.565c5.272,11.573-4.012,25.224-15.479,30.722c-11.468,5.503-24.672,5.774-36.958,9.057    c-12.286,3.279-25.024,11.467-26.675,24.08c-2.837,21.63,27.464,35.356,28.167,57.167c0.482,14.756-12.914,26.51-15.359,41.075    c-3.334,19.882,14.651,37.229,33.238,45.036s39.554,10.408,56.228,21.745C715.609,538.737,725.495,564.403,711.537,578.953z"
              className="fill-cradula-green dark:fill-cradula-red"
            />
          </g>
        </svg>
        <div className="z-2 pb-0.5 pl-0.5">
          {theme === "dark" ? (
            <MoonIcon className="w-8 h-8 md:w-20 md:h-20 text-neutral-900" />
          ) : (
            <SunIcon className="w-8 h-8 md:w-20 md:h-20 text-cradula-yellow dark:text-gray-200" />
          )}
        </div>
      </button>

      {/* Thunder-like flash + subtle rumble + glow */}
      <AnimatePresence>
        {flash && (
          <motion.div
            initial={{ opacity: 0 }}
            animate={{
              opacity: [0, 1, 0.2, 1, 0],
              x: [0, -3, 3, -2, 2, 0], // subtle rumble
            }}
            exit={{ opacity: 0 }}
            transition={{
              duration: 0.6,
              times: [0, 0.2, 0.4, 0.6, 1],
              ease: "easeInOut",
            }}
            className="fixed inset-0 bg-white pointer-events-none z-50 shadow-[0_0_60px_30px_rgba(255,255,200,0.7)]"
          />
        )}
      </AnimatePresence>
    </div>
  );
}
